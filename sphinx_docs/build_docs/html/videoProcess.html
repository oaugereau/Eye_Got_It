<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Video processing &mdash; Eye Got It 5.1 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" type="text/css" />
      <link rel="stylesheet" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" type="text/css" />
      <link rel="stylesheet" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="MCQ Technical" href="mcqTechnical.html" />
    <link rel="prev" title="Report Validation" href="reportValidation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Eye Got It
            <img src="_static/eye_got_it.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Eye Got It:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="welcome.html">Welcome Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="simulation.html">Simulation Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="report.html">Report Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="parameters.html">Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="database.html">Database</a></li>
<li class="toctree-l1"><a class="reference internal" href="user.html">User</a></li>
<li class="toctree-l1"><a class="reference internal" href="mcq.html">MCQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="actionUnits.html">Action units</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Technical Documentation:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="requirement.html">Requirement</a></li>
<li class="toctree-l1"><a class="reference internal" href="project.html">Project Organization</a></li>
<li class="toctree-l1"><a class="reference internal" href="folder.html">Folder Content</a></li>
<li class="toctree-l1"><a class="reference internal" href="machineLearning.html">Machine Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="documentation.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="eyeTracker.html">Eye Tracker</a></li>
<li class="toctree-l1"><a class="reference internal" href="EyeVoiceSpan.html">Eye-voice Span</a></li>
<li class="toctree-l1"><a class="reference internal" href="compilation.html">Compilation</a></li>
<li class="toctree-l1"><a class="reference internal" href="simulationTechnical.html">Simulation Technical</a></li>
<li class="toctree-l1"><a class="reference internal" href="reportTechnical.html">Report Technical</a></li>
<li class="toctree-l1"><a class="reference internal" href="reportValidation.html">Report Validation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Video processing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#openface">OpenFace</a></li>
<li class="toctree-l2"><a class="reference internal" href="#opencv">OpenCV</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="mcqTechnical.html">MCQ Technical</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Appendix:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="appendix.html">Appendix</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Eye Got It</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Video processing</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/videoProcess.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="video-processing">
<span id="videoprocessing"></span><h1>Video processing<a class="headerlink" href="#video-processing" title="Permalink to this headline"></a></h1>
<section id="openface">
<span id="id1"></span><h2>OpenFace<a class="headerlink" href="#openface" title="Permalink to this headline"></a></h2>
<p>We used openFace in report to process the video (see the <a class="reference external" href="https://github.com/TadasBaltrusaitis/OpenFace/wiki">OpenFace
Wiki</a>).</p>
<figure class="align-default" id="openfaceinterface">
<a class="reference internal image-reference" href="_images/openFace.png"><img alt="Openface Interface" src="_images/openFace.png" style="width: 90.0%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 55 </span><span class="caption-text">Openface Interface</span><a class="headerlink" href="#openfaceinterface" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>When we are in report mode, we don’t use the graphic interface (<a class="reference internal" href="#openfaceinterface"><span class="std std-numref">Fig. 55</span></a>) but the
command line in terminal :
<code class="docutils literal notranslate"><span class="pre">FeatureExtraction.exe</span> <span class="pre">-f</span> <span class="pre">&quot;</span> <span class="pre">+</span> <span class="pre">inputVideo</span> <span class="pre">+</span> <span class="pre">&quot;</span> <span class="pre">-out_dir</span> <span class="pre">&quot;</span> <span class="pre">+</span> <span class="pre">outputVideo</span></code>.</p>
<p>In the output folder, four files are created and one folder as well :</p>
<ul class="simple">
<li><p>video_aligned/</p></li>
<li><p>video.avi</p></li>
<li><p>video.csv</p></li>
<li><p>video.hog</p></li>
<li><p>video_of_details.txt</p></li>
</ul>
<p>video_of_details.txt content :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Input</span><span class="p">:</span><span class="n">webcam</span>
<span class="n">Camera</span> <span class="n">parameters</span><span class="p">:</span><span class="mi">500</span><span class="p">,</span><span class="mi">500</span><span class="p">,</span><span class="mi">320</span><span class="p">,</span><span class="mi">240</span>
<span class="n">Output</span> <span class="n">HOG</span><span class="p">:</span><span class="n">video</span><span class="o">.</span><span class="n">hog</span>
<span class="n">Output</span> <span class="n">video</span><span class="p">:</span><span class="n">video</span><span class="o">.</span><span class="n">avi</span>
<span class="n">Output</span> <span class="n">aligned</span> <span class="n">directory</span><span class="p">:</span><span class="n">video_aligned</span>
<span class="n">Output</span> <span class="n">csv</span><span class="p">:</span><span class="n">video</span><span class="o">.</span><span class="n">csv</span>
<span class="n">Gaze</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">AUs</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">Landmarks</span> <span class="mi">2</span><span class="n">D</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">Landmarks</span> <span class="mi">3</span><span class="n">D</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">Pose</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">Shape</span> <span class="n">parameters</span><span class="p">:</span> <span class="mi">1</span>
</pre></div>
</div>
<p>The folder “video_aligned/” contain the extraction of
aligned faces from the video (<a class="reference internal" href="#openfacealignedfacetec"><span class="std std-numref">Fig. 56</span></a> ).</p>
<figure class="align-default" id="openfacealignedfacetec">
<a class="reference internal image-reference" href="_images/frame_det_00_000001.jpg"><img alt="Video Aligned face" src="_images/frame_det_00_000001.jpg" style="width: 25.0%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 56 </span><span class="caption-text">Video Aligned face</span><a class="headerlink" href="#openfacealignedfacetec" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>The “video.hog” (<a class="reference internal" href="#openfacehogtec"><span class="std std-numref">Fig. 57</span></a>) is written as a binary file (for
space consideration) and can be read by matlab script for example.</p>
<figure class="align-default" id="openfacehogtec">
<a class="reference internal image-reference" href="_images/hog_features.png"><img alt="Hog file" src="_images/hog_features.png" style="width: 25.0%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 57 </span><span class="caption-text">Hog file</span><a class="headerlink" href="#openfacehogtec" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>The “video.avi” video file show image peer image the
head and eyes position in 3D space (<a class="reference internal" href="#openfacevideotec"><span class="std std-numref">Fig. 58</span></a>)</p>
<figure class="align-default" id="openfacevideotec">
<a class="reference internal image-reference" href="_images/vlcsnap-2021-05-11-14h50m15s383.png"><img alt="Video processed" src="_images/vlcsnap-2021-05-11-14h50m15s383.png" style="width: 50.0%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 58 </span><span class="caption-text">Video processed</span><a class="headerlink" href="#openfacevideotec" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p><strong>CSV File</strong></p>
<p><strong>Source : openFace Wiki</strong></p>
<p><em>Basic</em>:</p>
<p>frame : the number of the frame (in case of sequences)</p>
<p>face_id : the face id (in case of multiple faces), there is no guarantee
that this is consistent across frames in case of FaceLandmarkVidMulti,
especially in longer sequences.</p>
<p>timestamp : the timer of video being processed in seconds (in case of
sequences).</p>
<p>confidence : how confident is the tracker in current landmark detection
estimage.</p>
<p>success : is the track successful (is there a face in the frame or do we
think we tracked it well).</p>
<p><em>Gaze related</em>:</p>
<p>gaze_0_x, gaze_0_y, gaze_0_z : Eye gaze direction vector in world
coordinates for eye 0 (normalized), eye 0 is the leftmost eye in the
image (think of it as a ray going from the left eye in the image in the
direction of the eye gaze).</p>
<p>gaze_1_x, gaze_1_y, gaze_1_z : Eye gaze direction vector in world
coordinates for eye 1 (normalized), eye 1 is the rightmost eye in the
image (think of it as a ray going from the right eye in the image in the
direction of the eye gaze).</p>
<p>gaze_angle_x, gaze_angle_y : Eye gaze direction in radians in world
coordinates averaged for both eyes and converted into more easy to use
format than gaze vectors. If a person is looking left-right this will
results in the change of gaze_angle_x (from positive to negative) and,
if a person is looking up-down this will result in change of
gaze_angle_y (from negative to positive), if a person is looking
straight ahead both of the angles will be close to 0 (within measurement
error).</p>
<p>eye_lmk_x_0, eye_lmk_x_1,… eye_lmk_x55, eye_lmk_y_1,… eye_lmk_y_55 : location of 2D eye region landmarks in pixels. The landmark index can be
found below</p>
<p>eye_lmk_X_0, eye_lmk_X_1,… eye_lmk_X55, eye_lmk_Y_0,… eye_lmk_Z_55 : location of 3D eye region landmarks in millimeters. The landmark index
can be found below</p>
<a class="reference internal image-reference" href="_images/eye_lmk_markup.png"><img alt="image" src="_images/eye_lmk_markup.png" style="width: 80.0%;" /></a>
<p><em>Pose</em>:</p>
<p>pose_Tx, pose_Ty, pose_Tz : the location of the head with respect to
camera in millimeters (positive Z is away from the camera).</p>
<p>pose_Rx, pose_Ry, pose_Rz : Rotation is in radians around X,Y,Z axes with
the convention R = Rx * Ry * Rz, left-handed positive sign. This can
be seen as pitch (Rx), yaw (Ry), and roll (Rz). The rotation is in world
coordinates with camera being the origin.</p>
<p>Lines in au intensities and au occurrences correspond to predicted
Action Unit presence and intensities respectively. For more details see
here.</p>
<p>Where the landmarks are no longer in pixel values but in millimetres and
we also report head pose and gaze (this however needs accurate estimates
of fx,fy,cx,cy. This functionality is useful for batch image processing
where the camera is the same and we want to know pose and gaze.</p>
<p><em>Landmarks locations in 2D</em>:</p>
<p>x_0, x_1, … x_66, x_67, y_0,…y_67 location of 2D landmarks in
pixels.</p>
<p><em>Landmarks locations in 3D</em>:</p>
<p>X_0, … X_67, Y_0,…Y_67, Z_0,…Z_67 location of 3D landmarks in
millimetres.</p>
<a class="reference internal image-reference" href="_images/landmark_scheme_68.png"><img alt="image" src="_images/landmark_scheme_68.png" style="width: 50.0%;" /></a>
<p><em>Rigid and non-rigid shape parameters</em>:</p>
<p>Parameters of a point distribution model (PDM) that describe the rigid
face shape (location, scale and rotation) and non-rigid face shape
(deformation due to expression and identity).</p>
<p>p_scale, p_rx, p_ry, p_rz, p_tx, p_ty - scale, rotation and translation
terms of the PDM.</p>
<p>p_0, p_1, … p_33 - non-rigid shape parameters.</p>
<p><em>Facial Action Units</em>:</p>
<p>Facial Action Units (AUs) are a way to describe human facial expression,
more details on Action Units can be found here
<a class="reference external" href="https://en.wikipedia.org/wiki/Facial_Action_Coding_System">https://en.wikipedia.org/wiki/Facial_Action_Coding_System</a> .</p>
<p>The system can detect the intensity (from 0 to 5) of 17 AUs:</p>
<p>AU01_r, AU02_r, AU04_r, AU05_r, AU06_r, AU07_r, AU09_r, AU10_r, AU12_r,
AU14_r, AU15_r, AU17_r, AU20_r, AU23_r, AU25_r, AU26_r, AU45_r</p>
<p>And the presense (0 absent, 1 present) of 18 AUs:</p>
<p>AU01_c, AU02_c, AU04_c, AU05_c, AU06_c, AU07_c, AU09_c, AU10_c, AU12_c,
AU14_c, AU15_c, AU17_c, AU20_c, AU23_c, AU25_c, AU26_c, AU28_c, AU45_c</p>
</section>
<section id="opencv">
<span id="id2"></span><h2>OpenCV<a class="headerlink" href="#opencv" title="Permalink to this headline"></a></h2>
<p>If openFace is not detected (is not possible because it is installed in
the same folder as Eye got It), openCv is used in place.</p>
<p>It create a video file named “video_processed.avi” and contain the video
with eyes and head graphic positions represented by blue and green
rectangles. (<a class="reference internal" href="#opencvvideo"><span class="std std-numref">Fig. 59</span></a>).</p>
<figure class="align-default" id="opencvvideo">
<a class="reference internal image-reference" href="_images/vlcsnap-2021-05-11-15h14m32s687.png"><img alt="video precessed" src="_images/vlcsnap-2021-05-11-15h14m32s687.png" style="width: 50.0%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 59 </span><span class="caption-text">video precessed</span><a class="headerlink" href="#opencvvideo" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>Two csv files are created : “eyes.csv” (<a class="reference internal" href="#eyescsv"><span class="std std-numref">Table 7</span></a> ) and “face.csv” (<a class="reference internal" href="#facecsv"><span class="std std-numref">Table 8</span></a>) and
contain coordinates of the eyes and the face, the video time and the
current number image.</p>
<table class="docutils align-default" id="eyescsv">
<caption><span class="caption-number">Table 7 </span><span class="caption-text">eyes.csv File example</span><a class="headerlink" href="#eyescsv" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 17%" />
<col style="width: 6%" />
<col style="width: 6%" />
<col style="width: 14%" />
<col style="width: 17%" />
<col style="width: 40%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>number</p></th>
<th class="head"><p>x</p></th>
<th class="head"><p>y</p></th>
<th class="head"><p>width</p></th>
<th class="head"><p>height</p></th>
<th class="head"><p>time</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>60</p></td>
<td><p>35</p></td>
<td><p>23</p></td>
<td><p>23</p></td>
<td><p>0:00:00.033333</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>60</p></td>
<td><p>34</p></td>
<td><p>21</p></td>
<td><p>21</p></td>
<td><p>0:00:00.133333</p></td>
</tr>
<tr class="row-even"><td><p>10</p></td>
<td><p>56</p></td>
<td><p>32</p></td>
<td><p>21</p></td>
<td><p>21</p></td>
<td><p>0:00:00.333333</p></td>
</tr>
<tr class="row-odd"><td><p>17</p></td>
<td><p>58</p></td>
<td><p>31</p></td>
<td><p>22</p></td>
<td><p>22</p></td>
<td><p>0:00:00.566667</p></td>
</tr>
<tr class="row-even"><td><p>20</p></td>
<td><p>61</p></td>
<td><p>32</p></td>
<td><p>22</p></td>
<td><p>22</p></td>
<td><p>0:00:00.666667</p></td>
</tr>
<tr class="row-odd"><td><p>24</p></td>
<td><p>62</p></td>
<td><p>31</p></td>
<td><p>23</p></td>
<td><p>23</p></td>
<td><p>0:00:00.800000</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default" id="facecsv">
<caption><span class="caption-number">Table 8 </span><span class="caption-text">face.csv File example</span><a class="headerlink" href="#facecsv" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 16%" />
<col style="width: 8%" />
<col style="width: 8%" />
<col style="width: 14%" />
<col style="width: 16%" />
<col style="width: 38%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>number</p></th>
<th class="head"><p>x</p></th>
<th class="head"><p>y</p></th>
<th class="head"><p>width</p></th>
<th class="head"><p>height</p></th>
<th class="head"><p>time</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>98</p></td>
<td><p>116</p></td>
<td><p>112</p></td>
<td><p>112</p></td>
<td><p>0:00:00.033333</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>102</p></td>
<td><p>117</p></td>
<td><p>108</p></td>
<td><p>108</p></td>
<td><p>0:00:00.133333</p></td>
</tr>
<tr class="row-even"><td><p>6</p></td>
<td><p>104</p></td>
<td><p>120</p></td>
<td><p>106</p></td>
<td><p>106</p></td>
<td><p>0:00:00.200000</p></td>
</tr>
<tr class="row-odd"><td><p>10</p></td>
<td><p>106</p></td>
<td><p>119</p></td>
<td><p>103</p></td>
<td><p>103</p></td>
<td><p>0:00:00.333333</p></td>
</tr>
<tr class="row-even"><td><p>11</p></td>
<td><p>104</p></td>
<td><p>120</p></td>
<td><p>105</p></td>
<td><p>105</p></td>
<td><p>0:00:00.366667</p></td>
</tr>
<tr class="row-odd"><td><p>12</p></td>
<td><p>101</p></td>
<td><p>118</p></td>
<td><p>109</p></td>
<td><p>109</p></td>
<td><p>0:00:00.400000</p></td>
</tr>
</tbody>
</table>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="reportValidation.html" class="btn btn-neutral float-left" title="Report Validation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="mcqTechnical.html" class="btn btn-neutral float-right" title="MCQ Technical" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Axel Nougier, Victor Menard.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>